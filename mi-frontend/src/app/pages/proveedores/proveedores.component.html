<!-- proveedores.component.html -->
<div class="proveedores-container">
  <h2>Gesti√≥n de Proveedores</h2>

  <!-- Mensajes de estado -->
  <div *ngIf="errorMessage" class="alert alert-error">
    {{ errorMessage }}
  </div>

  <div *ngIf="successMessage" class="alert alert-success">
    {{ successMessage }}
  </div>

  <!-- Botones principales de acci√≥n -->
  <div class="main-actions">
    <button class="btn btn-primary" (click)="openCreateModal()">
      Crear Proveedor
    </button>
    <button class="btn btn-secondary" (click)="loadProveedores()" [disabled]="isLoading">
      {{ isLoading ? 'Cargando...' : 'Ver Todos los Proveedores' }}
    </button>
  </div>

  <!-- Formulario de b√∫squeda -->
  <div class="search-section">
    <h3>üîç Buscar Proveedores</h3>
    <form [formGroup]="searchForm" (ngSubmit)="searchByNombre()" class="search-form">
      <div class="search-row">
        <div class="form-group">
          <label for="searchTerm">Buscar por nombre:</label>
          <input
            id="searchTerm"
            type="text"
            formControlName="searchTerm"
            placeholder="Ingrese nombre del proveedor..."
            class="form-control"
          />
          <small class="help-text">Busca proveedores por nombre - Escribe y presiona Buscar</small>
        </div>
      </div>
      <div class="search-actions">
        <button type="submit" class="btn btn-primary" [disabled]="isLoading">
          {{ isLoading ? 'Buscando...' : 'Buscar' }}
        </button>
        <button type="button" class="btn btn-secondary" (click)="resetSearch()" [disabled]="isLoading">
          Limpiar B√∫squeda
        </button>
      </div>
    </form>
  </div>

  <!-- Lista de proveedores -->
  <div class="list-section">
    <h3>
      {{ 
        searchMode === 'all' ? 'Todos los Proveedores' :
        'Resultados de B√∫squeda'
      }} ({{ filteredProveedores.length }})
    </h3>

    <div *ngIf="isLoading" class="loading">
      Cargando proveedores...
    </div>

    <div *ngIf="!isLoading && filteredProveedores.length === 0" class="no-data">
      <div *ngIf="searchMode === 'search'">
        No se encontraron proveedores que coincidan con la b√∫squeda
      </div>
      <div *ngIf="searchMode === 'all'">
        No hay proveedores registrados en el sistema
      </div>
    </div>

    <div *ngIf="!isLoading && filteredProveedores.length > 0" class="proveedores-grid">
      <div *ngFor="let proveedor of filteredProveedores" class="proveedor-card">
        <div class="proveedor-info">
          <h4>{{ proveedor.nombre }}</h4>
          <p *ngIf="proveedor.telefono"><strong>Tel√©fono:</strong> {{ proveedor.telefono }}</p>
          <p *ngIf="proveedor.contacto"><strong>Contacto:</strong> {{ proveedor.contacto }}</p>
          <p><strong>ID:</strong> {{ proveedor.id_proveedor }}</p>
        </div>
        <div class="proveedor-actions">
          <button 
            class="btn btn-warning btn-sm" 
            (click)="openEditModal(proveedor)"
            [disabled]="isLoading"
            title="Editar proveedor"
          >
            Editar
          </button>
          <button 
            class="btn btn-danger btn-sm" 
            (click)="openDeleteModal(proveedor)"
            [disabled]="isLoading"
            title="Eliminar proveedor"
          >
            Eliminar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal para crear proveedor -->
  <app-modal 
    [isOpen]="showCreateModal" 
    [title]="'Crear Nuevo Proveedor'"
    [showFooter]="false"
    (closed)="closeCreateModal()">
    
    <form [formGroup]="proveedorForm" (ngSubmit)="onCreate()" class="provider-form">
      <div class="form-row">
        <div class="form-group">
          <label for="nombre">Nombre *</label>
          <input
            id="nombre"
            type="text"
            formControlName="nombre"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('nombre')"
            placeholder="Nombre del proveedor"
          />
          <div *ngIf="isFieldInvalid('nombre')" class="error-message">
            {{ getFieldError('nombre') }}
          </div>
          <small class="form-help">Nombre √∫nico del proveedor</small>
        </div>

        <div class="form-group">
          <label for="telefono">Tel√©fono</label>
          <input
            id="telefono"
            type="text"
            formControlName="telefono"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('telefono')"
            placeholder="10 d√≠gitos"
          />
          <div *ngIf="isFieldInvalid('telefono')" class="error-message">
            {{ getFieldError('telefono') }}
          </div>
          <small class="form-help">10 d√≠gitos</small>
        </div>

        <div class="form-group">
          <label for="contacto">Contacto</label>
          <input
            id="contacto"
            type="text"
            formControlName="contacto"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('contacto')"
            placeholder="Persona de contacto"
          />
          <div *ngIf="isFieldInvalid('contacto')" class="error-message">
            {{ getFieldError('contacto') }}
          </div>
          <small class="form-help">Persona de contacto</small>
        </div>
      </div>

      <div class="form-actions">
        <button 
          type="submit" 
          class="btn btn-primary" 
          [disabled]="isLoading || proveedorForm.invalid"
        >
          {{ isLoading ? 'Creando...' : 'Crear Proveedor' }}
        </button>
        <button 
          type="button" 
          class="btn btn-secondary" 
          (click)="closeCreateModal()"
          [disabled]="isLoading"
        >
          Cancelar
        </button>
      </div>
    </form>
  </app-modal>

  <!-- Modal para editar proveedor -->
  <app-modal 
    [isOpen]="showEditModal" 
    [title]="'Editar Proveedor'"
    [showFooter]="false"
    (closed)="closeEditModal()">
    
    <form [formGroup]="proveedorForm" (ngSubmit)="onUpdate()" class="provider-form" *ngIf="selectedProveedor">
      <div class="form-row">
        <div class="form-group">
          <label for="edit-nombre">Nombre *</label>
          <input
            id="edit-nombre"
            type="text"
            formControlName="nombre"
            class="form-control"
            readonly
          />
          <small class="form-help">El nombre no se puede modificar</small>
        </div>

        <div class="form-group">
          <label for="edit-telefono">Tel√©fono</label>
          <input
            id="edit-telefono"
            type="text"
            formControlName="telefono"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('telefono')"
            placeholder="10 d√≠gitos"
          />
          <div *ngIf="isFieldInvalid('telefono')" class="error-message">
            {{ getFieldError('telefono') }}
          </div>
          <small class="form-help">10 d√≠gitos</small>
        </div>

        <div class="form-group">
          <label for="edit-contacto">Contacto</label>
          <input
            id="edit-contacto"
            type="text"
            formControlName="contacto"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('contacto')"
            placeholder="Persona de contacto"
          />
          <div *ngIf="isFieldInvalid('contacto')" class="error-message">
            {{ getFieldError('contacto') }}
          </div>
          <small class="form-help">Persona de contacto</small>
        </div>
      </div>

      <div class="provider-info">
        <h4>Informaci√≥n del Proveedor</h4>
        <p><strong>ID Proveedor:</strong> {{ selectedProveedor.id_proveedor }}</p>
      </div>

      <div class="form-actions">
        <button 
          type="submit" 
          class="btn btn-primary" 
          [disabled]="isLoading || proveedorForm.invalid"
        >
          {{ isLoading ? 'Actualizando...' : 'Actualizar' }}
        </button>
        <button 
          type="button" 
          class="btn btn-secondary" 
          (click)="closeEditModal()"
          [disabled]="isLoading"
        >
          Cancelar
        </button>
      </div>
    </form>
  </app-modal>

  <!-- Modal para eliminar proveedor -->
  <app-modal 
    [isOpen]="showDeleteModal" 
    [title]="'Eliminar Proveedor'"
    [showFooter]="true"
    (closed)="closeDeleteModal()"
    (confirmed)="onDelete()">
    
    <div *ngIf="selectedProveedor">
      <p>¬øEst√°s seguro de que quieres eliminar al proveedor <strong>"{{ selectedProveedor.nombre }}"</strong>?</p>
      <div class="provider-details">
        <p><strong>ID Proveedor:</strong> {{ selectedProveedor.id_proveedor }}</p>
        <p><strong>Tel√©fono:</strong> {{ selectedProveedor.telefono || 'No especificado' }}</p>
        <p><strong>Contacto:</strong> {{ selectedProveedor.contacto || 'No especificado' }}</p>
      </div>
      <p class="text-warning">‚ö†Ô∏è Esta acci√≥n no se puede deshacer.</p>
    </div>
  </app-modal>
</div>
